{% extends "base.html" %}
{% load static %}



{% block content %}
<!-- Loading JS -->
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

<div class="container-fluid bg-dark text-white" style="min-height: 100vh; padding: 2rem;">
    
    <h1>Portfolio Performance Comparison</h1>
    <hr>
    
    <p class="lead">
        Most recent nav from Yahoo Finance is {{ latest_date|date:"d/m/Y" }}
    </p>

    <!-- Chart Mode Toggle (Prices/Returns) -->
    <div class="btn-group mb-3" role="group">
        <input type="radio" class="btn-check" name="chartMode" id="modePrices" value="Prices" autocomplete="off">
        <label class="btn btn-outline-secondary" for="modePrices">Prices</label>
        
        <input type="radio" class="btn-check" name="chartMode" id="modeReturns" value="Returns" autocomplete="off" checked>
        <label class="btn btn-outline-secondary" for="modeReturns">Returns</label>
    </div>

    <!-- Timeframe Buttons -->
    <div class="mb-3">
        <div class="btn-group" role="group">
            <button class="btn btn-secondary" data-timeframe="1m">1m</button>
            <button class="btn btn-secondary" data-timeframe="3m">3m</button>
            <button class="btn btn-secondary" data-timeframe="6m">6m</button>
            <button class="btn btn-secondary" data-timeframe="ytd">YTD</button>
            <button class="btn btn-secondary" data-timeframe="1y">1Y</button>
            <button class="btn btn-secondary" data-timeframe="3y">3Y</button>
            <button class="btn btn-secondary active" data-timeframe="max">Max</button>
        </div>
    </div>

    <!-- Chart Container (Plotly will render here) -->
    <div id="chartDiv" style="height: 700px; width: 100%;"></div>

    <script>
    // Get chart data from Django context
    const chartData = {{ chart|safe }};
    
    // Render the chart initially
    Plotly.newPlot('chartDiv', chartData.data, chartData.layout, {responsive: true});
    </script>

    <script src="{% static 'js/home_native.js' %}"></script>

    <!-- Performance Table -->
<div class="mt-3">
    <h3 class="mb-3">Portfolio Performance</h3>
    <table class="table table-dark table-hover">
        <thead>
            <tr>
                <th>Portfolio</th>
                {% for tf in timeframes %}
                <th class="text-center">{{ tf }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for perf in performance_data %}
            <tr>
                <td>
                    <a href="/portfolio/{{ perf.portfolio_id }}" class="text-decoration-none">
                        {{ perf.portfolio_name }}
                    </a>
                </td>
                {% for p in perf.performances %}
                <td class="text-center">
                    {% if p is not None %}
                        {{ p|floatformat:2 }}%
                    {% else %}
                        -
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


</div>


{% endblock %}